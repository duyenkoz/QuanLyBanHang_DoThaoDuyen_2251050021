{% extends 'admin/layout_admin/base.html' %}
{% block title %}Thêm danh mục{% endblock %}
{% block content %}

<!-- Form Thêm danh mục -->
<div class="card shadow-sm mt-4">
  <div class="card-header bg-secondary text-white">
    <h5 class="mb-0">Thêm danh mục</h5>
  </div>
  <div class="card-body">
    <form id="categoryForm" method="POST">
      <div class="row">
        <!-- Tên danh mục -->
        <div class="col-md-6 mb-3">
          <label for="Title" class="form-label">Tên danh mục <span class="text-danger">(*)</span></label>
          <input type="text" class="form-control" id="Title" name="Title" required>
        </div>

        <!-- Danh mục cha -->
        <div class="col-md-6 mb-3">
          <label for="ParentID" class="form-label">Danh mục cha (nếu có)</label>
          <select class="form-select" id="ParentID" name="ParentID">
            <option value="">-- Không chọn --</option>
            {% for cate in parent_categories %}
            <option value="{{ cate.ID }}" data-status="{{ cate.Status }}">{{ cate.Title }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Loại -->
        <div class="col-md-6 mb-3" id="typeWrapper">
          <label for="Type" class="form-label">Loại <span class="text-danger">(*)</span></label>
          <select class="form-select" id="TypeSelect" name="Type">
            <!-- <option value="">-- Chọn loại --</option> -->
            <option value="1">Menu</option>
            <option value="2">Sản phẩm đóng gói</option>
          </select>
        </div>

        <!-- Phân loại -->
        <div class="col-md-6 mb-3 d-none" id="typeCodeWrapper">
          <label for="TypeCode" class="form-label">Phân loại <span class="text-danger">(*)</span></label>
          <select class="form-select" id="TypeCodeSelect" name="TypeCode">
            <!-- <option value="">-- Chọn phân loại --</option> -->
            <option value="DRINK_SIZE_ONLY">Chỉ chọn size</option>
            <option value="DRINK_FULL">Đầy đủ lựa chọn</option>
            <option value="QUANTITY_ONLY">Chỉ chọn số lượng</option>
          </select>
        </div>

        <!-- Trạng thái -->
        <div class="col-md-6 mb-3">
          <label class="form-label">Trạng thái</label>
          <div class="d-flex mt-2">
            <div class="form-check me-3">
              <input class="form-check-input" type="radio" name="Status" id="Status1" value="1" checked>
              <label class="form-check-label" for="Status1">Hiện</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="Status" id="Status0" value="0">
              <label class="form-check-label" for="Status0">Ẩn</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="d-flex justify-content-end gap-2">
        <a href="{{ url_for('admin_cate_bp.admin_manage_categories') }}" class="btn btn-secondary">Trở về</a>
        <button type="submit" class="btn btn-primary">Thêm</button>
      </div>
    </form>
  </div>
</div>

<script>
  $(document).ready(function(){
    // Validate form
    $('#categoryForm').validate({
      rules: {
        Title: {
          required: true,
          minlength: 3,
          maxlength: 255
        },
        ParentID: {
          required: false
        },
      },
      messages: {
        Title: {
          required: "Vui lòng nhập tên danh mục",
          minlength: "Tên danh mục phải ít nhất 3 ký tự",
          maxlength: "Tên danh mục không được vượt quá 255 ký tự"
        },
      }
    });
  });

  document.addEventListener("DOMContentLoaded", function () {
    const parentSelect = document.getElementById("ParentID");
    const typeWrapper = document.getElementById("typeWrapper");
    const typeCodeWrapper = document.getElementById("typeCodeWrapper");
    const typeSelect = document.getElementById("TypeSelect");
    const typeCodeSelect = document.getElementById("TypeCodeSelect");
    const status1 = document.getElementById("Status1"); // nút Hiện
    const status0 = document.getElementById("Status0"); // nút Ẩn

    function toggleTypeFields() {
      if (parentSelect.value) {
        typeWrapper.classList.add("d-none");
        typeSelect.disabled = true;

        typeCodeWrapper.classList.remove("d-none");
        typeCodeSelect.disabled = false;
      } else {
        typeWrapper.classList.remove("d-none");
        typeSelect.disabled = false;

        typeCodeWrapper.classList.add("d-none");
        typeCodeSelect.disabled = true;
      }
    }

    function updateStatusOptions() {
      const selectedOption = parentSelect.options[parentSelect.selectedIndex];
      const parentStatus = selectedOption.getAttribute("data-status");

      if (parentSelect.value && parentStatus === "0") {
        // Danh mục cha đang bị ẩn
        status1.disabled = true;
        status0.checked = true;
      } else {
        status1.disabled = false;
      }
    }

    parentSelect.addEventListener("change", function () {
      toggleTypeFields();
      updateStatusOptions();
    });

    toggleTypeFields();      // chạy khi trang load
    updateStatusOptions();   // chạy khi trang load
  });
</script>


{% endblock %}