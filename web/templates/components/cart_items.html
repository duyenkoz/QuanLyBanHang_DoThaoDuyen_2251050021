<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/cart.css') }}"
/>
{% if cart_items|length > 0 %}
  <div class="card-body d-flex flex-column" style="height:60vh; box-sizing:border-box; padding:1rem;">
    
    <!-- HEADER: giữ nguyên vị trí, không bị cuộn -->
    <div class="cart-header">
      <div class="card-title mb-0">
        Giỏ hàng của bạn đang có
        <strong class="cart-count-item text-success">{{ total_item }}</strong>
        sản phẩm
      </div>
      <hr class="cart-divider my-2" />
    </div>

    <div class="cart-list hidden-scrollbar">
      {% for item in cart_items %}
      <div class="row align-items-center border-bottom py-2 item-info" id="item-info-{{item.id}}" data-id="{{item.id}}" data-price="{{item.price}}" data-total-price="{{item.total_price}}" data-productid="{{item.productid}}">
        <div class="d-flex justify-content-between">
          <span class="d-inline-flex btn-delete-item"><i role="button" class="fa-solid fa-xmark text-danger"></i></span>
          <span class="d-inline-flex btn-edit-item"><i role="button" class="fa-solid fa-pen-to-square text-success"></i></span>
        </div>
        <div class="col-auto">
          <img
            src="{{ url_for('static', filename=item.image if item.image else 'default.png') }}"
            alt="{{item.title}}"
            class="img-fluid rounded"
            style="width: 80px"
          />
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="col">
          <h6 class="mb-1 text-success fw-bold">{{item.title}}</h6>
          <p class="mb-1 text-muted small">
            {% if item.size %} Kích cỡ: {{item.size}}, {% endif %} {% if
            item.sugar %} Ngọt: {{item.sugar}}%, {% endif %} {% if item.ice %}
            Đá: {{item.ice}}%, {% endif %}
          </p>
          {% if item.toppings and item.toppings|length > 0 %}
          <p class="mb-1 text-muted small">
            Toppings: {{item.toppings|join(', ')}}
          </p>
          {% endif %}
          <div id="item-total-price-{{item.id}}" class="fw-bold text-success">
            <span class="price">{{"{:,.0f}".format(item.total_price) }}</span>
            <span class="text-lowercase">đ</span>
          </div>
        </div>

        <div class="col-auto text-center">
          <button class="btn btn-link p-0 text-success">
            <i class="bi bi-pencil-fill"></i>
          </button>
          <button class="btn btn-link p-0 text-danger">
            <i class="bi bi-trash-fill"></i>
          </button>
        </div>

        <div class="col-auto">
          <div
            class="d-flex align-items-center"     
          >
            <button class="btn btn-decrease btn-danger btn-sm">-</button>
            <span class="mx-2 item-quantity">{{item.quantity}}</span>
            <button class="btn btn-increase btn-success btn-sm">+</button>
          </div>
        </div>
      </div>
      {% endfor %}
    </div> 

  </div> 

<!-- / Shopping cart table -->

<div class="payment-section">
  <h5>Thông tin thanh toán</h5>
  <div class="payment-row">
    <span>Tổng tiền tạm tính</span>
    <span
      ><span class="cart-total-price">{{"{:,.0f}".format(total_price)}}</span>
      đ</span
    >
  </div>
  <div class="payment-row">
    <span>Phí vận chuyển</span>
    <span></span>
  </div>
  <div class="payment-row total">
    <span>Tổng tiền (Đã có VAT)</span>
    <span class="text-success"
      ><span class="cart-total-payment">{{"{:,.0f}".format(total_price)}}</span>
      đ</span
    >
  </div>

  <h5>Phương thức thanh toán</h5>
  <div class="payment-methods">
    <label>
      <input type="radio" name="payment" value="COD" checked /> Thanh toán tiền mặt (COD)</label>
  </div>

  <button id="btn-payment" class="btn btn-pay">Đặt hàng</button>
</div>

<input type="hidden" id="hdf-cart-total-price" value="{{total_price}}" />
{% endif %}
